!function(e){var t={};function o(n){if(t[n])return t[n].exports;var l=t[n]={i:n,l:!1,exports:{}};return e[n].call(l.exports,l,l.exports,o),l.l=!0,l.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)o.d(n,l,function(t){return e[t]}.bind(null,l));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=1)}([function(module,__webpack_exports__,__webpack_require__){"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{},n=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(o).filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}))),n.forEach(function(t){_defineProperty(e,t,o[t])})}return e}function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function asyncGeneratorStep(e,t,o,n,l,r,a){try{var i=e[r](a),s=i.value}catch(e){return void o(e)}i.done?t(s):Promise.resolve(s).then(n,l)}function _asyncToGenerator(e){return function(){var t=this,o=arguments;return new Promise(function(n,l){var r=e.apply(t,o);function a(e){asyncGeneratorStep(r,n,l,a,i,"next",e)}function i(e){asyncGeneratorStep(r,n,l,a,i,"throw",e)}a(void 0)})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var __=wp.i18n.__,_wp$element=wp.element,Component=_wp$element.Component,Fragment=_wp$element.Fragment,_wp$components=wp.components,IconButton=_wp$components.IconButton,DropZone=_wp$components.DropZone,PanelBody=_wp$components.PanelBody,RangeControl=_wp$components.RangeControl,CheckboxControl=_wp$components.CheckboxControl,TextControl=_wp$components.TextControl,SelectControl=_wp$components.SelectControl,Toolbar=_wp$components.Toolbar,withNotices=_wp$components.withNotices,_wp$editor=wp.editor,BlockControls=_wp$editor.BlockControls,MediaUpload=_wp$editor.MediaUpload,MediaPlaceholder=_wp$editor.MediaPlaceholder,InspectorControls=_wp$editor.InspectorControls,mediaUpload=_wp$editor.mediaUpload,meowGalleryIcon=React.createElement("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},React.createElement("rect",{width:"20",height:"20"}),React.createElement("path",{d:"M16.6667 3.33334V13.3333H6.66667V3.33334H16.6667ZM16.6667 1.66667H6.66667L5 3.33334V13.3333L6.66667 15H16.6667L18.3333 13.3333V3.33334L16.6667 1.66667Z",fill:"#2D4B6D"}),React.createElement("path",{d:"M10 10L10.8333 11.6667L13.3333 9.16667L15.8333 12.5H7.5L10 10Z",fill:"#1ABC9C"}),React.createElement("path",{d:"M1.66667 5V16.6667L3.33333 18.3333H15V16.6667H3.33333V5H1.66667Z",fill:"#2D4B6D"})),linkOptions=[{value:"attachment",label:__("Attachment Page")},{value:"media",label:__("Media File")},{value:"none",label:__("None")}],ALLOWED_MEDIA_TYPES=["image"],pickRelevantMediaFiles=function(e){return{alt:e.alt,id:e.id,link:e.link,url:e.url,caption:e.caption}},GalleryEdit=function(_Component){function GalleryEdit(){var e;return _classCallCheck(this,GalleryEdit),(e=_possibleConstructorReturn(this,_getPrototypeOf(GalleryEdit).apply(this,arguments))).onSelectImages=e.onSelectImages.bind(_assertThisInitialized(_assertThisInitialized(e))),e.setLinkTo=e.setLinkTo.bind(_assertThisInitialized(_assertThisInitialized(e))),e.setColumns=e.setColumns.bind(_assertThisInitialized(_assertThisInitialized(e))),e.addFiles=e.addFiles.bind(_assertThisInitialized(_assertThisInitialized(e))),e.uploadFromFiles=e.uploadFromFiles.bind(_assertThisInitialized(_assertThisInitialized(e))),e.state={isBusy:!1,selectedImage:null},e}return _inherits(GalleryEdit,_Component),_createClass(GalleryEdit,[{key:"onSelectImages",value:function(e){var t=e.map(function(e){return pickRelevantMediaFiles(e)});this.props.setAttributes({images:t}),this.onRefresh({images:t})}},{key:"setLinkTo",value:function(e){this.props.setAttributes({linkTo:e})}},{key:"setUseDefaults",value:function(e){this.props.setAttributes({useDefaults:e}),this.onRefresh({useDefaults:e})}},{key:"setCaptions",value:function(e){this.props.setAttributes({captions:e}),this.onRefresh({captions:e})}},{key:"setCustomClass",value:function(e){this.props.setAttributes({customClass:e})}},{key:"setGutter",value:function(e){this.props.setAttributes({gutter:e}),this.onRefresh({gutter:e})}},{key:"setGalleryEmpty",value:function(){this.props.setAttributes({images:[],htmlPreview:""}),(this.props.attributes.wplrCollection||this.props.attributes.wplrFolder)&&this.onRefresh({images:[]})}},{key:"setRowHeight",value:function(e){this.props.setAttributes({rowHeight:e}),this.onRefresh({rowHeight:e})}},{key:"setWplrCollection",value:function(e){if(!e||""===e)return this.props.setAttributes({wplrCollection:"",wplrFolder:"",htmlPreview:""}),void(this.props.attributes.images.length&&this.onRefresh({wplrCollection:"",wplrFolder:""}));var t=mgl_gallery_block_params.wplr_collections.find(function(t){return t.wp_col_id===e});t.is_folder="1"===t.is_folder,this.props.setAttributes({wplrCollection:t.is_folder?"":e,wplrFolder:t.is_folder?e:""}),this.onRefresh({wplrCollection:t.is_folder?"":e,wplrFolder:t.is_folder?e:""})}},{key:"setColumns",value:function(e){this.props.setAttributes({columns:e}),this.onRefresh({columns:e})}},{key:"setLayout",value:function(e){this.props.setAttributes({layout:e}),this.onRefresh({layout:e})}},{key:"setAnimation",value:function(e){this.props.setAttributes({animation:e}),this.onRefresh({animation:e})}},{key:"onRefresh",value:function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,o,n,l,r,a,i,s,c,u,p,m,f,d,h=this,y=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=y.length>0&&void 0!==y[0]?y[0]:{},o=_objectSpread({},this.props.attributes,t),n=o.images.map(function(e){return e.id}),l=o.layout,r=o.useDefaults,a=o.animation,i=o.gutter,s=o.columns,c=o.rowHeight,u=o.captions,p=o.wplrCollection,m=o.wplrFolder,this.setState({isBusy:!0}),e.next=7,fetch("".concat(wpApiSettings.root,"meow_gallery/preview"),{cache:"no-cache",headers:{"user-agent":"WP Block","content-type":"application/json"},method:"POST",redirect:"follow",referrer:"no-referrer",body:r?JSON.stringify({ids:n,layout:l,"wplr-collection":p,"wplr-folder":m}):JSON.stringify({ids:n,layout:l,gutter:i,columns:s,"row-height":c,animation:a,captions:u,"wplr-collection":p,"wplr-folder":m})}).then(function(e){if(h.setState({isBusy:!1}),e.ok)return e;throw new Error("Network response was not ok.")});case 7:return f=e.sent,e.next=10,f.json();case 10:d=e.sent,this.props.setAttributes({htmlPreview:d});case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"uploadFromFiles",value:function(e){this.addFiles(e.target.files)}},{key:"addFiles",value:function(e){var t=this,o=this.props.attributes.images||[],n=this.props,l=n.noticeOperations,r=n.setAttributes;mediaUpload({allowedTypes:ALLOWED_MEDIA_TYPES,filesList:e,onFileChange:function(e){var n=e.map(function(e){return pickRelevantMediaFiles(e)}),l=o.concat(n);r({images:l}),t.onRefresh({images:l})},onError:l.createErrorNotice})}},{key:"refreshTiles",value:function(){window.mglCalculateRow?mglCalculateRow():console.log("Meow Gallery: mglCalculateRow does not exist.")}},{key:"refreshCarousel",value:function(){window.mglInitCarousels?mglInitCarousels():console.log("Meow Gallery: mglInitCarousels does not exist.")}},{key:"createElementFromHTML",value:function(e){var t=document.createElement("div");return t.innerHTML=e.trim(),t.firstChild}},{key:"refreshMap",value:function refreshMap(){if(window.mglInitMaps){var htmlPreviewDom=this.createElementFromHTML(this.props.attributes.htmlPreview?this.props.attributes.htmlPreview:"");if(htmlPreviewDom&&htmlPreviewDom.getElementsByTagName("script")[0]){var js=htmlPreviewDom.getElementsByTagName("script")[0].innerText;eval(js),mglInitMaps()}}else console.log("Meow Gallery: mglInitMaps does not exist.")}},{key:"componentDidMount",value:function(){var e=this.props.attributes,t=e.layout,o=e.images,n=e.wplrCollection,l=e.wplrFolder,r=e.htmlPreview;t||this.props.setAttributes({layout:"tiles"}),"tiles"===t&&this.refreshTiles(),"carousel"===t&&this.refreshCarousel(),"map"===t&&this.refreshMap(),(o.length>0||!!n||!!l)&&!r&&this.onRefresh()}},{key:"componentDidUpdate",value:function(e){"tiles"===this.props.attributes.layout&&this.refreshTiles(),"carousel"===this.props.attributes.layout&&this.refreshCarousel(),"map"===this.props.attributes.layout&&this.refreshMap()}},{key:"render",value:function(){var e=this,t=this.state.isBusy,o=this.props,n=o.attributes,l=(o.isSelected,o.className),r=o.noticeOperations,a=o.noticeUI,i=n.layout,s=n.useDefaults,c=n.images,u=n.gutter,p=n.columns,m=n.rowHeight,f=n.htmlPreview,d=n.animation,h=n.captions,y=n.wplrCollection,g=n.wplrFolder,_=n.linkTo,b=n.customClass,w=React.createElement(DropZone,{onFilesDrop:this.addFiles}),v=c.length>0||!!y||!!g,C=React.createElement(BlockControls,null,v&&React.createElement(Toolbar,null,React.createElement(MediaUpload,{onSelect:this.onSelectImages,allowedTypes:ALLOWED_MEDIA_TYPES,multiple:!0,gallery:!0,value:c.map(function(e){return e.id}),render:function(e){var t=e.open;return React.createElement(IconButton,{className:"components-toolbar__control",label:__("Edit Gallery"),icon:"edit",onClick:t})}}),React.createElement(IconButton,{className:"components-toolbar__control",label:__("Remove all"),icon:"minus",onClick:function(){return e.setGalleryEmpty()}}),React.createElement(IconButton,{className:"components-toolbar__control",label:__("Refresh"),icon:"controls-repeat",onClick:function(){return e.onRefresh()}}))),k="";if(window.mgl_gallery_block_params&&mgl_gallery_block_params.wplr_collections){var R=mgl_gallery_block_params.wplr_collections.map(function(e){return{label:(e.level>0?"- ":"")+e.name.padStart(e.name.length+e.level," "),value:e.wp_col_id,disabled:"true"===e.is_folder}});R.unshift({label:"None",value:""}),k=React.createElement(SelectControl,{label:__("LR Folder or Collection","meow-gallery"),value:y||g,onChange:function(t){return e.setWplrCollection(t)},options:R})}return React.createElement(Fragment,null,C,!v&&React.createElement(MediaPlaceholder,{icon:meowGalleryIcon,className:l,multiple:!0,accept:"image/*",labels:{title:__("Meow Gallery"),instructions:__("Drag images, upload new ones or select files from your library. If WP/LR Sync is installed, you can directly select a collection or a folder from Lightroom.")},onSelect:this.onSelectImages,allowedTypes:ALLOWED_MEDIA_TYPES,notices:a,onError:r.createErrorNotice}),React.createElement(InspectorControls,null,React.createElement(PanelBody,{title:__("Gallery Settings")},React.createElement(SelectControl,{label:__("Layout","meow-gallery"),value:i,onChange:function(t){return e.setLayout(t)},options:[{value:"default",label:"Default"},{value:"tiles",label:"Tiles"},{value:"masonry",label:"Masonry"},{value:"justified",label:"Justified"},{value:"square",label:"Square"},{value:"cascade",label:"Cascade"},{value:"carousel",label:"Carousel"},{value:"map",label:"Map"}]}),v&&!s&&React.createElement(SelectControl,{label:__("Animation","meow-gallery"),value:d,onChange:function(t){return e.setAnimation(t)},options:[{value:"default",label:"Default"},{value:"zoom-out",label:"Zoom Out"},{value:"zoom-in",label:"Zoom In"},{value:"fade-out",label:"Fade Out"},{value:"fade-in",label:"Fade In"},{value:"colorize",label:"Colorize"},{value:"highlight",label:"Highlight"}]}),React.createElement(SelectControl,{label:__("Link To"),value:_,onChange:this.setLinkTo,options:linkOptions}),k,v&&!s&&React.createElement(RangeControl,{label:__("Gutter"),value:u,min:0,max:100,onChange:function(t){return e.setGutter(t)}}),v&&!s&&("masonry"===i||"square"===i)&&React.createElement(RangeControl,{label:__("Columns"),value:p,min:2,max:5,onChange:function(t){return e.setColumns(t)}}),v&&!s&&"justified"===i&&React.createElement(RangeControl,{label:__("Row Height"),value:m,min:50,max:500,onChange:function(t){return e.setRowHeight(t)}}),v&&!s&&React.createElement(CheckboxControl,{label:__("Captions"),checked:h,onChange:function(t){return e.setCaptions(t)}}),v&&React.createElement(CheckboxControl,{label:__("Use Default Settings"),checked:s,onChange:function(t){return e.setUseDefaults(t)}}),React.createElement(TextControl,{label:__("Custom CSS Classes"),value:b,onChange:function(t){return e.setCustomClass(t)}}))),a,React.createElement("div",null,w,t&&React.createElement("div",{className:"mgl-gtb-container"+(t?" mgl-busy":"")},React.createElement("span",{className:"components-spinner",style:{}})),f&&React.createElement("div",{dangerouslySetInnerHTML:{__html:f}}),v&&!f&&React.createElement("p",null,"Please ",React.createElement("a",{style:{cursor:"pointer"},onClick:function(){return e.onRefresh()}},"click here")," to refresh the preview.")))}}]),GalleryEdit}(Component);__webpack_exports__.a=withNotices(GalleryEdit)},function(e,t,o){"use strict";o.r(t);var n,l=o(0);function r(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var a=wp.i18n.__,i=wp.element.Fragment,s=wp.blocks,c=s.registerBlockType,u=s.createBlock,p=React.createElement("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},React.createElement("rect",{width:"20",height:"20",fill:"white"}),React.createElement("path",{d:"M16.6667 3.33334V13.3333H6.66667V3.33334H16.6667ZM16.6667 1.66667H6.66667L5 3.33334V13.3333L6.66667 15H16.6667L18.3333 13.3333V3.33334L16.6667 1.66667Z",fill:"#2D4B6D"}),React.createElement("path",{d:"M10 10L10.8333 11.6667L13.3333 9.16667L15.8333 12.5H7.5L10 10Z",fill:"#1ABC9C"}),React.createElement("path",{d:"M1.66667 5V16.6667L3.33333 18.3333H15V16.6667H3.33333V5H1.66667Z",fill:"#2D4B6D"})),m=(r(n={customClass:{type:"string",default:""},images:{type:"array",default:[]},linkTo:{type:"string",default:"none"},layout:{type:"string",default:"default"},animation:{type:"animation",default:""},useDefaults:{type:"string",default:"default"},htmlPreview:{type:"text",default:null}},"useDefaults",{type:"boolean",default:!0}),r(n,"captions",{type:"boolean",default:!1}),r(n,"columns",{type:"number",default:3}),r(n,"wplrCollection",{type:"string",default:""}),r(n,"wplrFolder",{type:"string",default:""}),r(n,"gutter",{type:"number",default:10}),r(n,"rowHeight",{type:"number",default:140}),n),f=function(e){var t=e.useDefaults,o=e.layout,n=e.rowHeight,l=e.columns,r=(e.customClass,function(e){var t=e.align,o=e.useDefaults,n=e.images,l=e.layout,r=e.animation,a=e.gutter,i=e.captions,s=e.wplrCollection,c=e.wplrFolder,u=e.linkTo,p=e.customClass,m=n.map(function(e){return e.id}).join(","),f='ids="'.concat(m,'" ');l&&"default"!==l&&(f+='layout="'.concat(l,'" ')),!o&&r&&(f+='animation="'.concat(r,'" ')),!o&&a&&(f+='gutter="'.concat(a,'" ')),o||(f+='captions="'.concat(i?"true":"false",'" '));return s&&(f+='wplr-collection="'.concat(s,'" ')),c&&(f+='wplr-folder="'.concat(c,'" ')),u&&"none"!==u&&(f+='link="'.concat(u,'" ')),t&&(f+='align="'.concat(t,'" ')),p&&(f+='custom-class="'.concat(p,'" ')),f.trim()}(e)),a="";return t?a="[gallery ".concat(r,"][/gallery]"):"tiles"===o?a="[gallery ".concat(r,"][/gallery]"):"cascade"===o?a="[gallery ".concat(r,"][/gallery]"):"masonry"===o?a="[gallery ".concat(r,' columns="').concat(l,'"][/gallery]'):"justified"===o?a="[gallery ".concat(r,' row-height="').concat(n,'"][/gallery]'):"square"===o?a="[gallery ".concat(r,' columns="').concat(l,'"][/gallery]'):"slider"===o?a="[gallery ".concat(r,"][/gallery]"):"map"===o?a="[gallery ".concat(r,"][/gallery]"):(alert("This layout is not handled. Check the Console Logs."),console.log("Layout could not be handled.",e)),a};c("meow-gallery/gallery",{title:a("Meow Gallery"),description:a("Display photos using specialized layouts for photographers."),icon:p,category:"layout",keywords:[a("images"),a("photos"),a("lightroom")],attributes:m,supports:{className:!1,customClassName:!1,html:!0,align:["full","wide"]},edit:l.a,save:function(e){var t=e.attributes,o=f(t);return React.createElement(i,null,o)},deprecated:[{attributes:m,save:function(e){var t=e.attributes,o=f(t).replace(' captions="false"',"");return React.createElement(i,null,o)}},{attributes:m,save:function(e){var t=e.attributes,o=function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{},n=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(o).filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}))),n.forEach(function(t){r(e,t,o[t])})}return e}({},t,{layout:"default"===t.layout?"tiles":t.layout}),n=f(o);return React.createElement(i,null,n)}}],transforms:{from:[{type:"block",isMultiBlock:!1,blocks:["core/gallery"],transform:function(e){var t=e.images;return u("meow-gallery/gallery",{images:t})}},{type:"block",isMultiBlock:!0,blocks:["core/image"],transform:function(e){var t=e.filter(function(e){return e.id&&e.url});return u("meow-gallery/gallery",{images:t.map(function(e){return{id:e.id,url:e.url,alt:e.alt,caption:e.caption}})})}}],to:[{type:"block",blocks:["core/image"],transform:function(e){var t=e.images,o=e.align;return t.length>0?t.map(function(e){var t=e.id,n=e.url,l=e.alt,r=e.caption;return u("core/image",{id:t,url:n,alt:l,caption:r,align:o})}):u("core/image",{align:o})}},{type:"block",blocks:["core/gallery"],transform:function(e){var t=e.images,o=e.align;return u("core/gallery",{images:t,align:o})}}]}})}]);
//# sourceMappingURL=index.js.map