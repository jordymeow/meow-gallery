!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){l(e,t,n[t])})}return e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t,n,r,o,l,a){try{var i=e[l](a),s=i.value}catch(e){return void n(e)}i.done?t(s):Promise.resolve(s).then(r,o)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}n.r(t);var f=wp.i18n.__,p=wp.element,m=p.Component,y=p.Fragment,h=wp.components,g=h.IconButton,d=(h.Icon,h.DropZone),b=h.FormFileUpload,v=h.PanelBody,w=h.RangeControl,R=h.CheckboxControl,k=h.SelectControl,E=h.Toolbar,S=h.withNotices,C=wp.editor,O=C.BlockControls,j=C.MediaUpload,P=C.MediaPlaceholder,_=C.InspectorControls,D=C.mediaUpload,T=(f("Attachment Page"),f("Media File"),f("None"),["image"]),F=function(e){return{alt:e.alt,id:e.id,link:e.link,url:e.url,caption:e.caption}},L=S(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?c(e):t}(this,s(t).apply(this,arguments))).onSelectImages=e.onSelectImages.bind(c(c(e))),e.setLinkTo=e.setLinkTo.bind(c(c(e))),e.setColumns=e.setColumns.bind(c(c(e))),e.addFiles=e.addFiles.bind(c(c(e))),e.uploadFromFiles=e.uploadFromFiles.bind(c(c(e))),e.state={isBusy:!1,selectedImage:null},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,m),function(e,t,n){t&&i(e.prototype,t),n&&i(e,n)}(t,[{key:"onSelectImages",value:function(e){var t=e.map(function(e){return F(e)});this.props.setAttributes({images:t}),this.onRefresh({images:t})}},{key:"setLinkTo",value:function(e){this.props.setAttributes({linkTo:e})}},{key:"setUseDefaults",value:function(e){this.props.setAttributes({useDefaults:e}),this.onRefresh({useDefaults:e})}},{key:"setCaptions",value:function(e){this.props.setAttributes({captions:e}),this.onRefresh({captions:e})}},{key:"setGutter",value:function(e){this.props.setAttributes({gutter:e}),this.onRefresh({gutter:e})}},{key:"setRowHeight",value:function(e){this.props.setAttributes({rowHeight:e}),this.onRefresh({rowHeight:e})}},{key:"setColumns",value:function(e){this.props.setAttributes({columns:e}),this.onRefresh({columns:e})}},{key:"setLayout",value:function(e){this.props.setAttributes({layout:e}),this.onRefresh({layout:e})}},{key:"onRefresh",value:function(){var e=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var l=e.apply(t,n);function i(e){a(l,r,o,i,s,"next",e)}function s(e){a(l,r,o,i,s,"throw",e)}i(void 0)})}}(regeneratorRuntime.mark(function e(){var t,n,r,l,a,i,s,u,c,f,p,m=this,y=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=y.length>0&&void 0!==y[0]?y[0]:{},n=o({},this.props.attributes,t),r=n.images.map(function(e){return e.id}),l=n.layout,a=n.useDefaults,i=n.gutter,s=n.columns,u=n.rowHeight,c=n.captions,this.setState({isBusy:!0}),e.next=7,fetch("".concat(wpApiSettings.root,"meow_gallery/preview"),{cache:"no-cache",headers:{"user-agent":"WP Block","content-type":"application/json"},method:"POST",redirect:"follow",referrer:"no-referrer",body:a?JSON.stringify({ids:r,layout:l}):JSON.stringify({ids:r,layout:l,gutter:i,columns:s,"row-height":u,captions:c})}).then(function(e){if(m.setState({isBusy:!1}),e.ok)return e;throw new Error("Network response was not ok.")});case 7:return f=e.sent,e.next=10,f.json();case 10:p=e.sent,this.props.setAttributes({htmlPreview:p});case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"uploadFromFiles",value:function(e){this.addFiles(e.target.files)}},{key:"addFiles",value:function(e){var t=this,n=this.props.attributes.images||[],r=this.props,o=r.noticeOperations,l=r.setAttributes;D({allowedTypes:T,filesList:e,onFileChange:function(e){var r=e.map(function(e){return F(e)}),o=n.concat(r);l({images:o}),t.onRefresh({images:o})},onError:o.createErrorNotice})}},{key:"refreshTiles",value:function(){window.mglCalculateRow?mglCalculateRow():console.log("Meow Gallery: mglCalculateRow does not exist.")}},{key:"refreshSlider",value:function(){window.mglInitSliders?mglInitSliders():console.log("Meow Gallery: mglInitSliders does not exist.")}},{key:"componentDidMount",value:function(){this.props.attributes.layout||this.props.setAttributes({layout:"tiles"}),"tiles"===this.props.attributes.layout&&this.refreshTiles(),"slider"===this.props.attributes.layout&&this.refreshSlider()}},{key:"componentDidUpdate",value:function(e){"tiles"===this.props.attributes.layout&&this.refreshTiles(),"slider"===this.props.attributes.layout&&this.refreshSlider()}},{key:"render",value:function(){var e=this,t=this.state.isBusy,n=this.props,r=n.attributes,o=n.isSelected,l=n.className,a=n.noticeOperations,i=n.noticeUI,s=r.layout,u=r.useDefaults,c=r.images,p=r.gutter,m=r.columns,h=r.rowHeight,S=r.htmlPreview,C=r.captions,D=React.createElement(d,{onFilesDrop:this.addFiles}),F=React.createElement(O,null,!!c.length&&React.createElement(E,null,React.createElement(j,{onSelect:this.onSelectImages,allowedTypes:T,multiple:!0,gallery:!0,value:c.map(function(e){return e.id}),render:function(e){var t=e.open;return React.createElement(g,{className:"components-toolbar__control",label:f("Edit Gallery"),icon:"edit",onClick:t})}}),React.createElement(g,{className:"components-toolbar__control",label:f("Refresh"),icon:"controls-repeat",onClick:function(){return e.onRefresh()}})));return 0===c.length?React.createElement(y,null,F,React.createElement(P,{icon:"format-gallery",className:l,multiple:!0,accept:"image/*",labels:{title:f("Gallery"),instructions:f("Drag images, upload new ones or select files from your library.")},onSelect:this.onSelectImages,allowedTypes:T,notices:i,onError:a.createErrorNotice})):React.createElement(y,null,F,React.createElement(_,null,React.createElement(v,{title:f("Gallery Settings")},React.createElement(k,{label:f("Layout","meow-gallery"),value:s,onChange:function(t){return e.setLayout(t)},options:[{value:"default",label:"Default"},{value:"tiles",label:"Tiles"},{value:"masonry",label:"Masonry"},{value:"justified",label:"Justified"},{value:"square",label:"Square"},{value:"slider",label:"Slider"}]}),c.length>1&&!u&&React.createElement(w,{label:f("Gutter"),value:p,min:0,max:100,onChange:function(t){return e.setGutter(t)}}),c.length>1&&!u&&("masonry"===s||"square"===s)&&React.createElement(w,{label:f("Columns"),value:m,min:2,max:5,onChange:function(t){return e.setColumns(t)}}),c.length>1&&!u&&"justified"===s&&React.createElement(w,{label:f("Row Height"),value:h,min:50,max:500,onChange:function(t){return e.setRowHeight(t)}}),c.length>1&&!u&&React.createElement(R,{label:f("Captions"),checked:C,onChange:function(t){return e.setCaptions(t)}}),c.length>1&&React.createElement(R,{label:f("Use Default Settings"),checked:u,onChange:function(t){return e.setUseDefaults(t)}}))),i,React.createElement("div",null,D,t&&React.createElement("div",{className:"mgl-gtb-container"+(t?" mgl-busy":"")},React.createElement("span",{className:"components-spinner",style:{}})),S&&React.createElement("div",{dangerouslySetInnerHTML:{__html:S}}),!S&&React.createElement("p",null,"Please ",React.createElement("a",{style:{cursor:"pointer"},onClick:function(){return e.onRefresh()}},"click here")," to refresh the preview."),0===c.length&&o&&React.createElement("div",{className:"blocks-gallery-item has-add-item-button"},React.createElement(b,{multiple:!0,isLarge:!0,className:"block-library-gallery-add-item-button",onChange:this.uploadFromFiles,accept:"image/*",icon:"insert"},f("Upload an image")))))}}]),t}()),x=wp.i18n.__,H=wp.element.Fragment,M=wp.blocks,B=M.registerBlockType,N=M.createBlock,A={images:{type:"array",default:[]},layout:{type:"string",default:"tiles"},htmlPreview:{type:"text",default:null},useDefaults:{type:"boolean",default:!0},captions:{type:"boolean",default:!1},columns:{type:"number",default:3},gutter:{type:"number",default:10},rowHeight:{type:"number",default:140}},I=function(e){var t=e.useDefaults,n=e.layout,r=e.rowHeight,o=e.columns,l=(e.linkTo,function(e){var t=e.align,n=e.useDefaults,r=e.images,o=e.layout,l=e.gutter,a=e.captions,i=r.map(function(e){return e.id}).join(","),s='ids="'.concat(i,'" ');o&&(s+='layout="'.concat(o,'" ')),!n&&l&&(s+='gutter="'.concat(l,'" ')),n||(s+='captions="'.concat(a?"true":"false",'" '));return t&&(s+='align="'.concat(t,'" ')),s.trim()}(e));return t?"[gallery ".concat(l,"][/gallery]"):"tiles"===n?"[gallery ".concat(l,"][/gallery]"):"masonry"===n?"[gallery ".concat(l,' columns="').concat(o,'"][/gallery]'):"justified"===n?"[gallery ".concat(l,' row-height="').concat(r,'"][/gallery]'):"square"===n?"[gallery ".concat(l,' columns="').concat(o,'"][/gallery]'):"slider"===n?"[gallery ".concat(l,"][/gallery]"):(alert("This layout is not handled. Check the Console Logs."),void console.log("Layout could not be handled.",e))};B("meow-gallery/gallery",{title:x("Meow Gallery"),description:x("Display photos using specialized layouts for photographers."),icon:React.createElement("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},React.createElement("rect",{width:"20",height:"20",fill:"white"}),React.createElement("path",{d:"M16.6667 3.33334V13.3333H6.66667V3.33334H16.6667ZM16.6667 1.66667H6.66667L5 3.33334V13.3333L6.66667 15H16.6667L18.3333 13.3333V3.33334L16.6667 1.66667Z",fill:"#2D4B6D"}),React.createElement("path",{d:"M10 10L10.8333 11.6667L13.3333 9.16667L15.8333 12.5H7.5L10 10Z",fill:"#1ABC9C"}),React.createElement("path",{d:"M1.66667 5V16.6667L3.33333 18.3333H15V16.6667H3.33333V5H1.66667Z",fill:"#2D4B6D"})),category:"layout",keywords:[x("images"),x("photos"),x("lightroom")],attributes:A,supports:{align:["full","wide"]},edit:L,save:function(e){var t=e.attributes,n=I(t);return React.createElement(H,null,n)},deprecated:[{attributes:A,save:function(e){var t=e.attributes,n=I(t).replace(' captions="false"',"");return React.createElement(H,null,n)}}],transforms:{from:[{type:"block",isMultiBlock:!1,blocks:["core/gallery"],transform:function(e){var t=e.images;return N("meow-gallery/gallery",{images:t})}}]}})}]);
//# sourceMappingURL=index.js.map