!function(e){var t={};function l(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,l),r.l=!0,r.exports}l.m=e,l.c=t,l.d=function(e,t,n){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},l.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(l.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)l.d(n,r,function(t){return e[t]}.bind(null,r));return n},l.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="",l(l.s=0)}([function(e,t,l){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e){for(var t=1;t<arguments.length;t++){var l=null!=arguments[t]?arguments[t]:{},n=Object.keys(l);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(l).filter(function(e){return Object.getOwnPropertyDescriptor(l,e).enumerable}))),n.forEach(function(t){o(e,t,l[t])})}return e}function o(e,t,l){return t in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e}function a(e,t,l,n,r,o,a){try{var i=e[o](a),s=i.value}catch(e){return void l(e)}i.done?t(s):Promise.resolve(s).then(n,r)}function i(e,t){for(var l=0;l<t.length;l++){var n=t[l];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}l.r(t);var p=wp.i18n.__,f=wp.element,m=f.Component,d=f.Fragment,h=wp.components,y=h.IconButton,g=(h.Icon,h.DropZone),b=(h.FormFileUpload,h.PanelBody),w=h.RangeControl,v=h.CheckboxControl,R=h.SelectControl,k=h.Toolbar,_=h.withNotices,C=wp.editor,E=C.BlockControls,S=C.MediaUpload,L=C.MediaPlaceholder,O=C.InspectorControls,F=C.mediaUpload,P=React.createElement("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},React.createElement("rect",{width:"20",height:"20"}),React.createElement("path",{d:"M16.6667 3.33334V13.3333H6.66667V3.33334H16.6667ZM16.6667 1.66667H6.66667L5 3.33334V13.3333L6.66667 15H16.6667L18.3333 13.3333V3.33334L16.6667 1.66667Z",fill:"#2D4B6D"}),React.createElement("path",{d:"M10 10L10.8333 11.6667L13.3333 9.16667L15.8333 12.5H7.5L10 10Z",fill:"#1ABC9C"}),React.createElement("path",{d:"M1.66667 5V16.6667L3.33333 18.3333H15V16.6667H3.33333V5H1.66667Z",fill:"#2D4B6D"})),D=[{value:"attachment",label:p("Attachment Page")},{value:"media",label:p("Media File")},{value:"none",label:p("None")}],H=["image"],T=function(e){return{alt:e.alt,id:e.id,link:e.link,url:e.url,caption:e.caption}},j=_(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?u(e):t}(this,s(t).apply(this,arguments))).onSelectImages=e.onSelectImages.bind(u(u(e))),e.setLinkTo=e.setLinkTo.bind(u(u(e))),e.setColumns=e.setColumns.bind(u(u(e))),e.addFiles=e.addFiles.bind(u(u(e))),e.uploadFromFiles=e.uploadFromFiles.bind(u(u(e))),e.state={isBusy:!1,selectedImage:null},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,m),function(e,t,l){t&&i(e.prototype,t),l&&i(e,l)}(t,[{key:"onSelectImages",value:function(e){var t=e.map(function(e){return T(e)});this.props.setAttributes({images:t}),this.onRefresh({images:t})}},{key:"setLinkTo",value:function(e){this.props.setAttributes({linkTo:e})}},{key:"setUseDefaults",value:function(e){this.props.setAttributes({useDefaults:e}),this.onRefresh({useDefaults:e})}},{key:"setCaptions",value:function(e){this.props.setAttributes({captions:e}),this.onRefresh({captions:e})}},{key:"setGutter",value:function(e){this.props.setAttributes({gutter:e}),this.onRefresh({gutter:e})}},{key:"setGalleryEmpty",value:function(){this.props.setAttributes({images:[],htmlPreview:""}),(this.props.attributes.wplrCollection||this.props.attributes.wplrFolder)&&this.onRefresh({images:[]})}},{key:"setRowHeight",value:function(e){this.props.setAttributes({rowHeight:e}),this.onRefresh({rowHeight:e})}},{key:"setWplrCollection",value:function(e){if(!e||""===e)return this.props.setAttributes({wplrCollection:"",wplrFolder:"",htmlPreview:""}),void(this.props.attributes.images.length&&this.onRefresh({wplrCollection:"",wplrFolder:""}));var t=mgl_gallery_block_params.wplr_collections.find(function(t){return t.wp_col_id===e});t.is_folder="1"===t.is_folder,this.props.setAttributes({wplrCollection:t.is_folder?"":e,wplrFolder:t.is_folder?e:""}),this.onRefresh({wplrCollection:t.is_folder?"":e,wplrFolder:t.is_folder?e:""})}},{key:"setColumns",value:function(e){this.props.setAttributes({columns:e}),this.onRefresh({columns:e})}},{key:"setLayout",value:function(e){this.props.setAttributes({layout:e}),this.onRefresh({layout:e})}},{key:"onRefresh",value:function(){var e=function(e){return function(){var t=this,l=arguments;return new Promise(function(n,r){var o=e.apply(t,l);function i(e){a(o,n,r,i,s,"next",e)}function s(e){a(o,n,r,i,s,"throw",e)}i(void 0)})}}(regeneratorRuntime.mark(function e(){var t,l,n,o,a,i,s,c,u,p,f,m,d,h=this,y=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=y.length>0&&void 0!==y[0]?y[0]:{},l=r({},this.props.attributes,t),n=l.images.map(function(e){return e.id}),o=l.layout,a=l.useDefaults,i=l.gutter,s=l.columns,c=l.rowHeight,u=l.captions,p=l.wplrCollection,f=l.wplrFolder,console.log(this.props.attributes),this.setState({isBusy:!0}),e.next=8,fetch("".concat(wpApiSettings.root,"meow_gallery/preview"),{cache:"no-cache",headers:{"user-agent":"WP Block","content-type":"application/json"},method:"POST",redirect:"follow",referrer:"no-referrer",body:a?JSON.stringify({ids:n,layout:o,"wplr-collection":p,"wplr-folder":f}):JSON.stringify({ids:n,layout:o,gutter:i,columns:s,"row-height":c,captions:u,"wplr-collection":p,"wplr-folder":f})}).then(function(e){if(h.setState({isBusy:!1}),e.ok)return e;throw new Error("Network response was not ok.")});case 8:return m=e.sent,e.next=11,m.json();case 11:d=e.sent,this.props.setAttributes({htmlPreview:d});case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"uploadFromFiles",value:function(e){this.addFiles(e.target.files)}},{key:"addFiles",value:function(e){var t=this,l=this.props.attributes.images||[],n=this.props,r=n.noticeOperations,o=n.setAttributes;F({allowedTypes:H,filesList:e,onFileChange:function(e){var n=e.map(function(e){return T(e)}),r=l.concat(n);o({images:r}),t.onRefresh({images:r})},onError:r.createErrorNotice})}},{key:"refreshTiles",value:function(){window.mglCalculateRow?mglCalculateRow():console.log("Meow Gallery: mglCalculateRow does not exist.")}},{key:"refreshSlider",value:function(){window.mglInitSliders?mglInitSliders():console.log("Meow Gallery: mglInitSliders does not exist.")}},{key:"componentDidMount",value:function(){this.props.attributes.layout||this.props.setAttributes({layout:"tiles"}),"tiles"===this.props.attributes.layout&&this.refreshTiles(),"slider"===this.props.attributes.layout&&this.refreshSlider()}},{key:"componentDidUpdate",value:function(e){"tiles"===this.props.attributes.layout&&this.refreshTiles(),"slider"===this.props.attributes.layout&&this.refreshSlider()}},{key:"render",value:function(){var e=this,t=this.state.isBusy,l=this.props,n=l.attributes,r=(l.isSelected,l.className),o=l.noticeOperations,a=l.noticeUI,i=n.layout,s=n.useDefaults,c=n.images,u=n.gutter,f=n.columns,m=n.rowHeight,h=n.htmlPreview,_=n.captions,C=n.wplrCollection,F=n.wplrFolder,T=n.linkTo,j=React.createElement(g,{onFilesDrop:this.addFiles}),M=c.length>0||!!C||!!F,x=React.createElement(E,null,M&&React.createElement(k,null,React.createElement(S,{onSelect:this.onSelectImages,allowedTypes:H,multiple:!0,gallery:!0,value:c.map(function(e){return e.id}),render:function(e){var t=e.open;return React.createElement(y,{className:"components-toolbar__control",label:p("Edit Gallery"),icon:"edit",onClick:t})}}),React.createElement(y,{className:"components-toolbar__control",label:p("Remove all"),icon:"minus",onClick:function(){return e.setGalleryEmpty()}}),React.createElement(y,{className:"components-toolbar__control",label:p("Refresh"),icon:"controls-repeat",onClick:function(){return e.onRefresh()}}))),B="";if(window.mgl_gallery_block_params&&mgl_gallery_block_params.wplr_collections){var A=mgl_gallery_block_params.wplr_collections.map(function(e){return{label:(e.level>0?"- ":"")+e.name.padStart(e.name.length+e.level," "),value:e.wp_col_id,disabled:"true"===e.is_folder}});A.unshift({label:"None",value:""}),B=React.createElement(R,{label:p("LR Folder or Collection","meow-gallery"),value:C||F,onChange:function(t){return e.setWplrCollection(t)},options:A})}return React.createElement(d,null,x,!M&&React.createElement(L,{icon:P,className:r,multiple:!0,accept:"image/*",labels:{title:p("Meow Gallery"),instructions:p("Drag images, upload new ones or select files from your library. If WP/LR Sync is installed, you can directly select a collection or a folder from Lightroom.")},onSelect:this.onSelectImages,allowedTypes:H,notices:a,onError:o.createErrorNotice}),React.createElement(O,null,React.createElement(b,{title:p("Gallery Settings")},React.createElement(R,{label:p("Layout","meow-gallery"),value:i,onChange:function(t){return e.setLayout(t)},options:[{value:"default",label:"Default"},{value:"tiles",label:"Tiles"},{value:"masonry",label:"Masonry"},{value:"justified",label:"Justified"},{value:"square",label:"Square"},{value:"cascade",label:"Cascade"},{value:"slider",label:"Slider"}]}),React.createElement(R,{label:p("Link To"),value:T,onChange:this.setLinkTo,options:D}),B,M&&!s&&React.createElement(w,{label:p("Gutter"),value:u,min:0,max:100,onChange:function(t){return e.setGutter(t)}}),M&&!s&&("masonry"===i||"square"===i)&&React.createElement(w,{label:p("Columns"),value:f,min:2,max:5,onChange:function(t){return e.setColumns(t)}}),M&&!s&&"justified"===i&&React.createElement(w,{label:p("Row Height"),value:m,min:50,max:500,onChange:function(t){return e.setRowHeight(t)}}),M&&!s&&React.createElement(v,{label:p("Captions"),checked:_,onChange:function(t){return e.setCaptions(t)}}),M&&React.createElement(v,{label:p("Use Default Settings"),checked:s,onChange:function(t){return e.setUseDefaults(t)}}))),a,React.createElement("div",null,j,t&&React.createElement("div",{className:"mgl-gtb-container"+(t?" mgl-busy":"")},React.createElement("span",{className:"components-spinner",style:{}})),h&&React.createElement("div",{dangerouslySetInnerHTML:{__html:h}}),M&&!h&&React.createElement("p",null,"Please ",React.createElement("a",{style:{cursor:"pointer"},onClick:function(){return e.onRefresh()}},"click here")," to refresh the preview.")))}}]),t}()),M=wp.i18n.__,x=wp.element.Fragment,B=wp.blocks,A=B.registerBlockType,I=B.createBlock,N=React.createElement("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},React.createElement("rect",{width:"20",height:"20",fill:"white"}),React.createElement("path",{d:"M16.6667 3.33334V13.3333H6.66667V3.33334H16.6667ZM16.6667 1.66667H6.66667L5 3.33334V13.3333L6.66667 15H16.6667L18.3333 13.3333V3.33334L16.6667 1.66667Z",fill:"#2D4B6D"}),React.createElement("path",{d:"M10 10L10.8333 11.6667L13.3333 9.16667L15.8333 12.5H7.5L10 10Z",fill:"#1ABC9C"}),React.createElement("path",{d:"M1.66667 5V16.6667L3.33333 18.3333H15V16.6667H3.33333V5H1.66667Z",fill:"#2D4B6D"})),V={images:{type:"array",default:[]},linkTo:{type:"string",default:"none"},layout:{type:"string",default:"tiles"},htmlPreview:{type:"text",default:null},useDefaults:{type:"boolean",default:!0},captions:{type:"boolean",default:!1},columns:{type:"number",default:3},wplrCollection:{type:"string",default:""},wplrFolder:{type:"string",default:""},gutter:{type:"number",default:10},rowHeight:{type:"number",default:140}},G=function(e){var t=e.useDefaults,l=e.layout,n=e.rowHeight,r=e.columns,o=(e.wplrCollection,e.linkTo,function(e){var t=e.align,l=e.useDefaults,n=e.images,r=e.layout,o=e.gutter,a=e.captions,i=e.wplrCollection,s=e.wplrFolder,c=e.linkTo,u=n.map(function(e){return e.id}).join(","),p='ids="'.concat(u,'" ');r&&(p+='layout="'.concat(r,'" ')),!l&&o&&(p+='gutter="'.concat(o,'" ')),l||(p+='captions="'.concat(a?"true":"false",'" '));return i&&(p+='wplr-collection="'.concat(i,'" ')),s&&(p+='wplr-folder="'.concat(s,'" ')),c&&"none"!==c&&(p+='link="'.concat(c,'" ')),t&&(p+='align="'.concat(t,'" ')),p.trim()}(e));return t?"[gallery ".concat(o,"][/gallery]"):"tiles"===l?"[gallery ".concat(o,"][/gallery]"):"cascade"===l?"[gallery ".concat(o,"][/gallery]"):"masonry"===l?"[gallery ".concat(o,' columns="').concat(r,'"][/gallery]'):"justified"===l?"[gallery ".concat(o,' row-height="').concat(n,'"][/gallery]'):"square"===l?"[gallery ".concat(o,' columns="').concat(r,'"][/gallery]'):"slider"===l?"[gallery ".concat(o,"][/gallery]"):(alert("This layout is not handled. Check the Console Logs."),void console.log("Layout could not be handled.",e))};A("meow-gallery/gallery",{title:M("Meow Gallery"),description:M("Display photos using specialized layouts for photographers."),icon:N,category:"layout",keywords:[M("images"),M("photos"),M("lightroom")],attributes:V,supports:{align:["full","wide"]},edit:j,save:function(e){var t=e.attributes,l=G(t);return React.createElement(x,null,l)},deprecated:[{attributes:V,save:function(e){var t=e.attributes,l=G(t).replace(' captions="false"',"");return React.createElement(x,null,l)}}],transforms:{from:[{type:"block",isMultiBlock:!1,blocks:["core/gallery"],transform:function(e){var t=e.images;return I("meow-gallery/gallery",{images:t})}}]}})}]);
//# sourceMappingURL=index.js.map